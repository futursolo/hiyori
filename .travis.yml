sudo: false

matrix:
  allow_failures:
    - python: nightly

  include:
    - os: linux
      python: 3.6.1
      env: PYVER=3.6

    - os: linux
      python: 3.6.2
      env: PYVER=3.6

    - os: linux
      python: 3.6.3
      env: PYVER=3.6

    - os: linux
      python: 3.6.4
      env: PYVER=3.6

    - os: linux
      python: 3.6.5
      env: PYVER=3.6 DEPLOY_PYPI=1

    - os: linux
      python: 3.6
      env: PYVER=3.6

    - os: linux
      python: nightly
      env: PYVER=3.7

language: python

install:
  - pip install -U pip setuptools
  - pip install .[test]

  - pip install -U coveralls

# commands to run tests
script:
  - mypy --python-version $PYVER --strict --ignore-missing-imports --show-error-context --show-traceback -p hiyori
  - flake8 .
  - coverage run --source=hiyori setup.py test

after_success:
  - coveralls

deploy:
  - provider: pypi
    distributions: sdist bdist_wheel
    server: https://test.pypi.org/legacy/
    user: "futursolo"
    password:
      secure: "sgaEYSUHuUfKHzf69qZAQFvZptQ2c2qCB4yfnezs49/7AjsL9oACo9ZUAmBWsPnrfqw+VU3gp71U1leRqM7Eccv0ComOM9xisCJNsvf7NDhRvBjLsqeGHDdp9tUtJItwSx5saMZzfzu5bXpZCpy50GaDfnzKpq54ZXKPVD+KcjtI2nwj/D8WPx1WqDxpWLNCkSXzl4mfnspKOtgJrjuBNCuOLql2kKMdmssDgghheVmCn/bVQBWo6n6yFD121Gy0BKID2rqt6LBf4tZn4OEhbZLWh99VRtm1Q+6ETfhVq0G1cBNgra9ieBDCe6THcCTtJcslmi88T3gbAxvtSJQQOCvxMaqaTl3/DEm/GAiIfDYxeN+egyc6maoieas99yczBE5UXxrZvLE4K0ypMuFJjOKC7xyjFLjqVTy0BWoBwy2+Bz6s30rZkNHBmyO1nn47tUgyGIPLRpHLlrjdeblHKh0zeLCJ5+uFXyRV1NFT+r+dfkxvYUGyAOMU/JUNsSxleD2AIDpmPBw4tg8ctGqdK2XjT62x66HtSl9svas/PFndEzi9raiOrWmiq/V1V/vCUxx4v5BFEMFsmg6qgFK+sQ0QMZR/zH1Yb93Hny/8GMtiVcb9IaOTqDPYsUlyaT5DEKlL82pIKsbuMizwZr8YrUHcz1sVOGLULlkl1H0HwNg="
    skip_cleanup: true
    skip_upload_docs: true
    on:
      branch: master
      tags: false
      condition: "$DEPLOY_PYPI = 1"

  - provider: pypi
    distributions: sdist bdist_wheel
    user: "futursolo"
    password:
      secure: "laB8gfoil3+OM7CI7lAB5a53nrpF23weaR5Wbwa1GJ6819yw4RCyWmLqfeM9vvBoLgTfkXl/ITxCWQT+7n4zZhVHhIipU+RObjW0VIgivqfv3MRj/LPsM+yNTlKgXJ6Wtql69efEb3HZeXt4OY0kHzl7W8VpgORdmQ4uA8ZkufwypFnAMSICLMBj9z2a9nHXsKyyx8vzd+uNdg7wWf2kFYpUhdji8gdnljitpxx9FImI7SUWC+4WWP7gd/HmBfceENhRtCicD6jfmUiHQ8oqRqs8d6rYbB/3VnEzc61s7vCEqXFVlaU0jjJ4dQuWniAxp3sCkLBnVVVEUqBfROn59qpfpqkeVg4R1P+/zO9DnfXOUtCRoPlIs33H69LRm5a7O82SZMOXYtwvqF+LBjE5wYnBsFqMqeK0EFHFoITXqQ/lglROCbgo+4iUbz5ESNFR1qxJt8RWhSNFQ1LaAAkGJd3aWgj94Yoob9r2Q9W69vSAIQnUmBfI5Q0dBbb5y5KtbnS4a6TpE96kE/ldfSCAj6S/YG6w5gkK7qsh3rggrM5V7Vg9h1fPFHIusg4ayYPTHRUmbyim6i5a0uP1Y0JN5NpoX5scwjg53Xzp4ByqS1LU5whmwUGA04FqcnMDLRZ7LvkmU9EV3xEslPHvatQMHsNbSuQFOST2OfXEuSMg0DM="
    skip_cleanup: true
    skip_upload_docs: true
    on:
      branch: master
      tags: true
      condition: "$DEPLOY_PYPI = 1"
